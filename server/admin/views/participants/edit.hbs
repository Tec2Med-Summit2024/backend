<header
  class='flex items-center justify-between py-6 px-6 mx-auto max-w-screen-2xl'
>
  <h1 class='text-4xl'>Edit Participant - {{participant.name}}</h1>

  <a
    href='/admin/participants'
    class='flex items-center gap-2 px-4 py-2 rounded-md bg-green-600 text-gray-100'
  >
    <span class='material-symbols-outlined'>arrow_back</span>
    Return to Participants
  </a>
</header>

<section class='mx-auto max-w-screen-2xl p-6'>
  <form
    id="edit-participant-form"
    action='/admin/participants/{{participant.username}}'
    method='post'
    class='grid grid-cols-2 gap-6 text-lg'
    autocomplete='off'
  >
    <div class='flex flex-col gap-4'>
      <div class='flex flex-col'>
        <label for='name'>Name</label>
        <input
          type='text'
          id='name'
          name='name'
          placeholder='{{participant.name}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
          maxlength="100"
          oninput="validateNameInput(this)"
        />
      </div>

      <div class='flex flex-col'>
        <label for='institution'>Institution</label>
        <input
          id='institution'
          name='institution'
          placeholder='{{participant.institution}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
          maxlength="40"
        />
      </div>

      <div class='flex flex-col'>
        <label>Interests</label>
        <div class='flex flex-wrap gap-2 mt-1'>
          {{#each (array 'Aerospace medicine' 'Artificial intelligence' 'Augmented reality' 'Biomedical imaging' 'Bionic systems' 'Bioprinting' 'Biosignals' 'Cell & tissue engineering' 'Chronic diseases' 'Clean technology' 'Clinical decision support systems' 'Clinical research' 'Data modelling' 'Data science' 'Data-driven healthcare' 'Dentistry' 'Epidemiology' 'Ethics' 'Genetics' 'Hardware & robotics' 'Health data privacy and security' 'Health policy' 'Machine learning' 'Medical simulation' 'Mental health' 'Neuroscience' 'Nuclear medicine' 'Nutrition' 'Orthopedics & biomechanics' 'Public health' 'Remote patient monitoring' 'Scientific writing' 'Statistics for research' 'Surgery' 'Virtual reality' 'Wearable technology') as |interest|}}
            <label class='relative cursor-pointer'>
              <input 
                type='checkbox' 
                name='interests' 
                value='{{interest}}' 
                class='peer opacity-0 absolute' 
                {{isChecked ../participant.interests interest}}
              />
              <span class='px-4 py-1 rounded-full border border-gray-300 bg-gray-100 text-gray-600 transition peer-checked:bg-green-300 peer-checked:text-gray-900 hover:bg-green-200'>{{interest}}</span>
            </label>
          {{/each}}
        </div>
        <span class="text-xs text-gray-500 mt-1">Select between 2 and 10 interests</span>
      </div>

      <div class='flex flex-col'>
        <label for='field_of_study_work_research'>Work Field</label>
        <input
          type='text'
          id='field_of_study_work_research'
          name='field_of_study_work_research'
          placeholder='{{participant.field_of_study_work_research}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
          maxlength="40"
        />
      </div>

      <div class='flex flex-col'>
        <label for='phone'>Phone</label>
        <div class='flex gap-2'>
          <select
            id='country_code'
            name='country_code'
            class='px-2 py-1 border border-gray-800 outline-none rounded-md bg-white'
            style='width: 120px;'
          >
            <option value='+351' {{#if (contains participant.phone '+351')}}selected{{/if}}>ğŸ‡µğŸ‡¹ +351</option>
            <option value='+1' {{#if (contains participant.phone '+1')}}selected{{/if}}>ğŸ‡ºğŸ‡¸ +1</option>
            <option value='+44' {{#if (contains participant.phone '+44')}}selected{{/if}}>ğŸ‡¬ğŸ‡§ +44</option>
            <option value='+33' {{#if (contains participant.phone '+33')}}selected{{/if}}>ğŸ‡«ğŸ‡· +33</option>
            <option value='+49' {{#if (contains participant.phone '+49')}}selected{{/if}}>ğŸ‡©ğŸ‡ª +49</option>
            <option value='+34' {{#if (contains participant.phone '+34')}}selected{{/if}}>ğŸ‡ªğŸ‡¸ +34</option>
            <option value='+39' {{#if (contains participant.phone '+39')}}selected{{/if}}>ğŸ‡®ğŸ‡¹ +39</option>
            <option value='+31' {{#if (contains participant.phone '+31')}}selected{{/if}}>ğŸ‡³ğŸ‡± +31</option>
            <option value='+32' {{#if (contains participant.phone '+32')}}selected{{/if}}>ğŸ‡§ğŸ‡ª +32</option>
            <option value='+41' {{#if (contains participant.phone '+41')}}selected{{/if}}>ğŸ‡¨ğŸ‡­ +41</option>
            <option value='+46' {{#if (contains participant.phone '+46')}}selected{{/if}}>ğŸ‡¸ğŸ‡ª +46</option>
            <option value='+47' {{#if (contains participant.phone '+47')}}selected{{/if}}>ğŸ‡³ğŸ‡´ +47</option>
            <option value='+45' {{#if (contains participant.phone '+45')}}selected{{/if}}>ğŸ‡©ğŸ‡° +45</option>
            <option value='+358' {{#if (contains participant.phone '+358')}}selected{{/if}}>ğŸ‡«ğŸ‡® +358</option>
            <option value='+48' {{#if (contains participant.phone '+48')}}selected{{/if}}>ğŸ‡µğŸ‡± +48</option>
            <option value='+420' {{#if (contains participant.phone '+420')}}selected{{/if}}>ğŸ‡¨ğŸ‡¿ +420</option>
            <option value='+36' {{#if (contains participant.phone '+36')}}selected{{/if}}>ğŸ‡­ğŸ‡º +36</option>
            <option value='+40' {{#if (contains participant.phone '+40')}}selected{{/if}}>ğŸ‡·ğŸ‡´ +40</option>
            <option value='+421' {{#if (contains participant.phone '+421')}}selected{{/if}}>ğŸ‡¸ğŸ‡° +421</option>
            <option value='+386' {{#if (contains participant.phone '+386')}}selected{{/if}}>ğŸ‡¸ğŸ‡® +386</option>
            <option value='+385' {{#if (contains participant.phone '+385')}}selected{{/if}}>ğŸ‡­ğŸ‡· +385</option>
            <option value='+371' {{#if (contains participant.phone '+371')}}selected{{/if}}>ğŸ‡±ğŸ‡» +371</option>
            <option value='+372' {{#if (contains participant.phone '+372')}}selected{{/if}}>ğŸ‡ªğŸ‡ª +372</option>
            <option value='+370' {{#if (contains participant.phone '+370')}}selected{{/if}}>ğŸ‡±ğŸ‡¹ +370</option>
            <option value='+375' {{#if (contains participant.phone '+375')}}selected{{/if}}>ğŸ‡§ğŸ‡¾ +375</option>
            <option value='+380' {{#if (contains participant.phone '+380')}}selected{{/if}}>ğŸ‡ºğŸ‡¦ +380</option>
            <option value='+7' {{#if (contains participant.phone '+7')}}selected{{/if}}>ğŸ‡·ğŸ‡º +7</option>
            <option value='+90' {{#if (contains participant.phone '+90')}}selected{{/if}}>ğŸ‡¹ğŸ‡· +90</option>
            <option value='+972' {{#if (contains participant.phone '+972')}}selected{{/if}}>ğŸ‡®ğŸ‡± +972</option>
            <option value='+971' {{#if (contains participant.phone '+971')}}selected{{/if}}>ğŸ‡¦ğŸ‡ª +971</option>
            <option value='+966' {{#if (contains participant.phone '+966')}}selected{{/if}}>ğŸ‡¸ğŸ‡¦ +966</option>
            <option value='+20' {{#if (contains participant.phone '+20')}}selected{{/if}}>ğŸ‡ªğŸ‡¬ +20</option>
            <option value='+27' {{#if (contains participant.phone '+27')}}selected{{/if}}>ğŸ‡¿ğŸ‡¦ +27</option>
            <option value='+234' {{#if (contains participant.phone '+234')}}selected{{/if}}>ğŸ‡³ğŸ‡¬ +234</option>
            <option value='+254' {{#if (contains participant.phone '+254')}}selected{{/if}}>ğŸ‡°ğŸ‡ª +254</option>
            <option value='+91' {{#if (contains participant.phone '+91')}}selected{{/if}}>ğŸ‡®ğŸ‡³ +91</option>
            <option value='+86' {{#if (contains participant.phone '+86')}}selected{{/if}}>ğŸ‡¨ğŸ‡³ +86</option>
            <option value='+81' {{#if (contains participant.phone '+81')}}selected{{/if}}>ğŸ‡¯ğŸ‡µ +81</option>
            <option value='+82' {{#if (contains participant.phone '+82')}}selected{{/if}}>ğŸ‡°ğŸ‡· +82</option>
            <option value='+65' {{#if (contains participant.phone '+65')}}selected{{/if}}>ğŸ‡¸ğŸ‡¬ +65</option>
            <option value='+60' {{#if (contains participant.phone '+60')}}selected{{/if}}>ğŸ‡²ğŸ‡¾ +60</option>
            <option value='+66' {{#if (contains participant.phone '+66')}}selected{{/if}}>ğŸ‡¹ğŸ‡­ +66</option>
            <option value='+84' {{#if (contains participant.phone '+84')}}selected{{/if}}>ğŸ‡»ğŸ‡³ +84</option>
            <option value='+62' {{#if (contains participant.phone '+62')}}selected{{/if}}>ğŸ‡®ğŸ‡© +62</option>
            <option value='+63' {{#if (contains participant.phone '+63')}}selected{{/if}}>ğŸ‡µğŸ‡­ +63</option>
            <option value='+61' {{#if (contains participant.phone '+61')}}selected{{/if}}>ğŸ‡¦ğŸ‡º +61</option>
            <option value='+64' {{#if (contains participant.phone '+64')}}selected{{/if}}>ğŸ‡³ğŸ‡¿ +64</option>
            <option value='+55' {{#if (contains participant.phone '+55')}}selected{{/if}}>ğŸ‡§ğŸ‡· +55</option>
            <option value='+54' {{#if (contains participant.phone '+54')}}selected{{/if}}>ğŸ‡¦ğŸ‡· +54</option>
            <option value='+56' {{#if (contains participant.phone '+56')}}selected{{/if}}>ğŸ‡¨ğŸ‡± +56</option>
            <option value='+57' {{#if (contains participant.phone '+57')}}selected{{/if}}>ğŸ‡¨ğŸ‡´ +57</option>
            <option value='+58' {{#if (contains participant.phone '+58')}}selected{{/if}}>ğŸ‡»ğŸ‡ª +58</option>
            <option value='+593' {{#if (contains participant.phone '+593')}}selected{{/if}}>ğŸ‡ªğŸ‡¨ +593</option>
            <option value='+595' {{#if (contains participant.phone '+595')}}selected{{/if}}>ğŸ‡µğŸ‡¾ +595</option>
            <option value='+598' {{#if (contains participant.phone '+598')}}selected{{/if}}>ğŸ‡ºğŸ‡¾ +598</option>
            <option value='+51' {{#if (contains participant.phone '+51')}}selected{{/if}}>ğŸ‡µğŸ‡ª +51</option>
            <option value='+52' {{#if (contains participant.phone '+52')}}selected{{/if}}>ğŸ‡²ğŸ‡½ +52</option>
            <option value='+503' {{#if (contains participant.phone '+503')}}selected{{/if}}>ğŸ‡¸ğŸ‡» +503</option>
            <option value='+502' {{#if (contains participant.phone '+502')}}selected{{/if}}>ğŸ‡¬ğŸ‡¹ +502</option>
            <option value='+504' {{#if (contains participant.phone '+504')}}selected{{/if}}>ğŸ‡­ğŸ‡³ +504</option>
            <option value='+505' {{#if (contains participant.phone '+505')}}selected{{/if}}>ğŸ‡³ğŸ‡® +505</option>
            <option value='+506' {{#if (contains participant.phone '+506')}}selected{{/if}}>ğŸ‡¨ğŸ‡· +506</option>
            <option value='+507' {{#if (contains participant.phone '+507')}}selected{{/if}}>ğŸ‡µğŸ‡¦ +507</option>
          </select>
          <input
            type='tel'
            id='phone'
            name='phone'
            placeholder='{{participant.phone}}'
            class='flex-1 px-2 py-1 border border-gray-800 outline-none rounded-md'
          />
        </div>
      </div>

      <script>
        // Parse phone number and set dropdown and placeholder
        document.addEventListener('DOMContentLoaded', function() {
          const phoneInput = document.getElementById('phone');
          const countrySelect = document.getElementById('country_code');
          const originalPhone = '{{participant.phone}}';
          const originalCountryCode = '{{participant.country_code}}';
          
          if (originalPhone) {
            // Set the placeholder to the phone number
            phoneInput.placeholder = originalPhone;
          }
          
          if (originalCountryCode) {
            // Set the dropdown selection based on the country_code field
            countrySelect.value = originalCountryCode;
          }
        });

        function validateNameInput(input) {
          const value = input.value;
          // Remove 'de', 'da', 'dos' and count names
          const names = value.split(' ').filter(name => 
            name.length > 0 && 
            !['de', 'da', 'dos'].includes(name.toLowerCase())
          );
          
          if (names.length > 3) {
            alert('Maximum 3 names allowed (ignoring "de", "da", "dos")');
          }
        }
      </script>

      <div class='flex flex-col'>
        <label for='website'>Website</label>
        <input
          type='text'
          id='website'
          name='website'
          placeholder='{{participant.website}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
        />
      </div>

      <div class='flex flex-col'>
        <label for='instagram'>Instagram</label>
        <input
          type='text'
          id='instagram'
          name='instagram'
          placeholder='{{participant.instagram}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
        />
      </div>
    </div>

    <div class='flex flex-col gap-4'>
      <div class='flex flex-col'>
        <label>Type</label>
        <div class='flex gap-4 mt-1'>
          <div class='flex items-center gap-2'>
            <input
              type='checkbox'
              id='type_attendee'
              name='type'
              value='Attendee'
              {{#if (contains participant.type 'Attendee')}}checked{{/if}}
              class='w-4 h-4'
            />
            <label for='type_attendee'>Attendee</label>
          </div>
          <div class='flex items-center gap-2'>
            <input
              type='checkbox'
              id='type_instructor'
              name='type'
              value='Instructor'
              {{#if (contains participant.type 'Instructor')}}checked{{/if}}
              class='w-4 h-4'
            />
            <label for='type_instructor'>Instructor</label>
          </div>
          <div class='flex items-center gap-2'>
            <input
              type='checkbox'
              id='type_speaker'
              name='type'
              value='Speaker'
              {{#if (contains participant.type 'Speaker')}}checked{{/if}}
              class='w-4 h-4'
            />
            <label for='type_speaker'>Speaker</label>
          </div>
        </div>
      </div>

      <div class='flex flex-col'>
        <label for='ticket_type'>Ticket Type</label>
        <input
          type='text'
          id='ticket_type'
          name='ticket_type'
          placeholder='{{participant.ticket_type}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
        />
      </div>

      <div class='flex flex-col'>
        <label>Expertise</label>
        <div class='flex flex-wrap gap-2 mt-1'>
          {{#each (array 'Aerospace medicine' 'Artificial intelligence' 'Augmented reality' 'Biomedical imaging' 'Bionic systems' 'Bioprinting' 'Biosignals' 'Cell & tissue engineering' 'Chronic diseases' 'Clean technology' 'Clinical decision support systems' 'Clinical research' 'Data modelling' 'Data science' 'Data-driven healthcare' 'Dentistry' 'Epidemiology' 'Ethics' 'Genetics' 'Hardware & robotics' 'Health data privacy and security' 'Health policy' 'Machine learning' 'Medical simulation' 'Mental health' 'Neuroscience' 'Nuclear medicine' 'Nutrition' 'Orthopedics & biomechanics' 'Public health' 'Remote patient monitoring' 'Scientific writing' 'Statistics for research' 'Surgery' 'Virtual reality' 'Wearable technology') as |expertise|}}
            <label class='relative cursor-pointer'>
              <input 
                type='checkbox' 
                name='expertise' 
                value='{{expertise}}' 
                class='peer opacity-0 absolute' 
                {{isChecked ../participant.expertise expertise}}
              />
              <span class='px-4 py-1 rounded-full border border-gray-300 bg-gray-100 text-gray-600 transition peer-checked:bg-green-300 peer-checked:text-gray-900 hover:bg-green-200'>{{expertise}}</span>
            </label>
          {{/each}}
        </div>
        <span class="text-xs text-gray-500 mt-1">Select between 2 and 6 expertises</span>
      </div>

      <div class='flex flex-col'>
        <label for='current_location'>Location</label>
        <input
          type='text'
          id='current_location'
          name='current_location'
          placeholder='{{participant.current_location}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
          maxlength="40"
        />
      </div>

      <div class='flex flex-col'>
        <label for='email'>Email</label>
        <input
          type='text'
          id='email'
          name='email'
          placeholder='{{participant.email}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
        />
      </div>

      <div class='flex flex-col'>
        <label for='linkedin'>LinkedIn</label>
        <input
          type='text'
          id='linkedin'
          name='linkedin'
          placeholder='{{participant.linkedin}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
        />
      </div>

      <div class='flex flex-col'>
        <label for='facebook'>Facebook</label>
        <input
          type='text'
          id='facebook'
          name='facebook'
          placeholder='{{participant.facebook}}'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
        />
      </div>
    </div>

    <div class='flex flex-col gap-2 col-span-2'>
      <label for='biography'>Biography</label>
      <textarea
        form="edit-participant-form"
        type='text'
        id='biography'
        name='biography'
        placeholder='{{participant.biography}}'
        class='px-2 py-1 border border-gray-800 outline-none rounded-md'
        rows='4'
        maxlength="40"
      ></textarea>
    </div>

    <div class='w-fit mx-auto col-span-2'>
      <button
        form="edit-participant-form"
        type='submit'
        class='px-6 py-2 bg-green-600 text-gray-100 rounded-md'
        onclick="return validateParticipantForm()"
      >Edit Participant</button>
    </div>
  </form>
</section>

<script>
  function validateParticipantForm() {
    const selectedInterests = document.querySelectorAll('input[name="interests"]:checked');
    const selectedExpertises = document.querySelectorAll('input[name="expertise"]:checked');
    
    if (selectedInterests.length < 2) {
      alert('Please select at least 2 interests');
      return false;
    }
    if (selectedInterests.length > 10) {
      alert('Please select no more than 10 interests');
      return false;
    }
    
    if (selectedExpertises.length < 2) {
      alert('Please select at least 2 expertises');
      return false;
    }
    if (selectedExpertises.length > 6) {
      alert('Please select no more than 6 expertises');
      return false;
    }
    
    return true;
  }
</script>
