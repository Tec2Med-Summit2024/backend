<header class='flex items-center justify-between py-6 px-6 mx-auto max-w-screen-2xl'>
  <h1 class='text-4xl'>Create New Participant</h1>

  <a
    href='/admin/participants'
    class='flex items-center gap-2 px-4 py-2 rounded-md bg-red-600 text-gray-100'>
    <span class='material-symbols-outlined'>arrow_back</span>
    Cancel
  </a>
</header>

<section class='mx-auto max-w-screen-2xl p-6'>
  <form
    id='create-participant-form'
    action='/admin/participants'
    method='post'
    class='grid grid-cols-2 gap-4 text-lg'
    autocomplete='off'
  >
    <!-- coluna da esquerda -->
    <div class='flex flex-col gap-4'>
      <div class='flex flex-col'>
        <label for='name'>Name *</label>
        <input type='text' id='name' name='name'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
          maxlength="100"
          required
          oninput="validateNameInput(this)" />
      </div>

      <div class='flex flex-col'>
        <label for='email'>Email *</label>
        <input type='email' id='email' name='email'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'
          required/>
      </div>

      <div class='flex flex-col'>
        <label for='phone'>Phone</label>
        <div class='flex gap-2'>
          <select id='country_code' name='country_code'
            class='px-2 py-1 border border-gray-800 outline-none rounded-md bg-white' style='width: 120px;'>
            <option value='+351' selected>ğŸ‡µğŸ‡¹ +351</option>
            <option value='+1'>ğŸ‡ºğŸ‡¸ +1</option>
            <option value='+44'>ğŸ‡¬ğŸ‡§ +44</option>
            <option value='+33'>ğŸ‡«ğŸ‡· +33</option>
            <option value='+49'>ğŸ‡©ğŸ‡ª +49</option>
            <option value='+34'>ğŸ‡ªğŸ‡¸ +34</option>
            <option value='+39'>ğŸ‡®ğŸ‡¹ +39</option>
            <option value='+31'>ğŸ‡³ğŸ‡± +31</option>
            <option value='+32'>ğŸ‡§ğŸ‡ª +32</option>
            <option value='+41'>ğŸ‡¨ğŸ‡­ +41</option>
            <option value='+46'>ğŸ‡¸ğŸ‡ª +46</option>
            <option value='+47'>ğŸ‡³ğŸ‡´ +47</option>
            <option value='+45'>ğŸ‡©ğŸ‡° +45</option>
            <option value='+358'>ğŸ‡«ğŸ‡® +358</option>
            <option value='+48'>ğŸ‡µğŸ‡± +48</option>
            <option value='+420'>ğŸ‡¨ğŸ‡¿ +420</option>
            <option value='+36'>ğŸ‡­ğŸ‡º +36</option>
            <option value='+40'>ğŸ‡·ğŸ‡´ +40</option>
            <option value='+421'>ğŸ‡¸ğŸ‡° +421</option>
            <option value='+386'>ğŸ‡¸ğŸ‡® +386</option>
            <option value='+385'>ğŸ‡­ğŸ‡· +385</option>
            <option value='+371'>ğŸ‡±ğŸ‡» +371</option>
            <option value='+372'>ğŸ‡ªğŸ‡ª +372</option>
            <option value='+370'>ğŸ‡±ğŸ‡¹ +370</option>
            <option value='+375'>ğŸ‡§ğŸ‡¾ +375</option>
            <option value='+380'>ğŸ‡ºğŸ‡¦ +380</option>
            <option value='+7'>ğŸ‡·ğŸ‡º +7</option>
            <option value='+90'>ğŸ‡¹ğŸ‡· +90</option>
            <option value='+972'>ğŸ‡®ğŸ‡± +972</option>
            <option value='+971'>ğŸ‡¦ğŸ‡ª +971</option>
            <option value='+966'>ğŸ‡¸ğŸ‡¦ +966</option>
            <option value='+20'>ğŸ‡ªğŸ‡¬ +20</option>
            <option value='+27'>ğŸ‡¿ğŸ‡¦ +27</option>
            <option value='+234'>ğŸ‡³ğŸ‡¬ +234</option>
            <option value='+254'>ğŸ‡°ğŸ‡ª +254</option>
            <option value='+91'>ğŸ‡®ğŸ‡³ +91</option>
            <option value='+86'>ğŸ‡¨ğŸ‡³ +86</option>
            <option value='+81'>ğŸ‡¯ğŸ‡µ +81</option>
            <option value='+82'>ğŸ‡°ğŸ‡· +82</option>
            <option value='+65'>ğŸ‡¸ğŸ‡¬ +65</option>
            <option value='+60'>ğŸ‡²ğŸ‡¾ +60</option>
            <option value='+66'>ğŸ‡¹ğŸ‡­ +66</option>
            <option value='+84'>ğŸ‡»ğŸ‡³ +84</option>
            <option value='+62'>ğŸ‡®ğŸ‡© +62</option>
            <option value='+63'>ğŸ‡µğŸ‡­ +63</option>
            <option value='+61'>ğŸ‡¦ğŸ‡º +61</option>
            <option value='+64'>ğŸ‡³ğŸ‡¿ +64</option>
            <option value='+55'>ğŸ‡§ğŸ‡· +55</option>
            <option value='+54'>ğŸ‡¦ğŸ‡· +54</option>
            <option value='+56'>ğŸ‡¨ğŸ‡± +56</option>
            <option value='+57'>ğŸ‡¨ğŸ‡´ +57</option>
            <option value='+58'>ğŸ‡»ğŸ‡ª +58</option>
            <option value='+593'>ğŸ‡ªğŸ‡¨ +593</option>
            <option value='+595'>ğŸ‡µğŸ‡¾ +595</option>
            <option value='+598'>ğŸ‡ºğŸ‡¾ +598</option>
            <option value='+51'>ğŸ‡µğŸ‡ª +51</option>
            <option value='+52'>ğŸ‡²ğŸ‡½ +52</option>
            <option value='+503'>ğŸ‡¸ğŸ‡» +503</option>
            <option value='+502'>ğŸ‡¬ğŸ‡¹ +502</option>
            <option value='+504'>ğŸ‡­ğŸ‡³ +504</option>
            <option value='+505'>ğŸ‡³ğŸ‡® +505</option>
            <option value='+506'>ğŸ‡¨ğŸ‡· +506</option>
            <option value='+507'>ğŸ‡µğŸ‡¦ +507</option>
          </select>
          <input type='tel' id='phone' name='phone'
            class='flex-1 px-2 py-1 border border-gray-800 outline-none rounded-md' placeholder='Phone number' />
        </div>
      </div>

      <div class='flex flex-col'>
        <label for='linkedin'>LinkedIn</label>
        <input type='text' id='linkedin' name='linkedin'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md' />
      </div>

      <div class='flex flex-col'>
        <label for='website'>Website</label>
        <input type='text' id='website' name='website'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md' />
      </div>

      <div class='flex flex-col'>
        <label for='instagram'>Instagram</label>
        <input type='text' id='instagram' name='instagram'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md' />
      </div>

      <div class='flex flex-col'>
        <label for='facebook'>Facebook</label>
        <input type='text' id='facebook' name='facebook'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md' />
      </div>

      <div class='flex flex-col'>
        <label>Interests *</label>
        <div class='flex flex-wrap gap-2 mt-1'>
          {{#each (array 'Aerospace medicine' 'Artificial intelligence' 'Augmented reality'
          'Biomedical imaging' 'Bionic systems' 'Bioprinting' 'Biosignals'
          'Cell & tissue engineering' 'Chronic diseases' 'Clean technology' 'Clinical decision support systems' 'Clinical research'
          'Data modelling' 'Data science' 'Data-driven healthcare' 'Dentistry' 'Epidemiology' 'Ethics' 'Genetics'
          'Hardware & robotics' 'Healthcare' 'Health data privacy and security' 'Health policy'
          'Machine learning' 'Medical simulation' 'Mental health' 'Neuroscience' 'Nuclear medicine' 'Nutrition'
          'Orthopedics & biomechanics' 'Public health' 'Remote patient monitoring'
          'Scientific writing' 'Statistics for research' 'Surgery' 'Virtual reality' 'Wearable technology') as |interest|}}
          <label class='relative cursor-pointer'>
            <input type='checkbox' name='interests' value='{{interest}}'
              class='peer opacity-0 absolute' />
            <span class='px-4 py-1 rounded-full border border-gray-300 bg-gray-100 text-gray-600 transition peer-checked:bg-green-300 peer-checked:text-gray-900 hover:bg-green-200'>{{interest}}</span>
          </label>
          {{/each}}
        </div>
        <span class="text-xs text-gray-500 mt-1">Select between 2 and 10 interests</span>
      </div>

    </div>
    
    <!-- coluna da direita -->
    <div class='flex flex-col gap-4'>
      <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css' />

      <!-- Ainda nÃ£o implementado o upload da foto de perfil -->
      <!--
      <div class='flex flex-col'>
        <label for='profile_picture'>Profile picture</label>
        <input
          type='file' id='profile_picture' name='profile_picture' />
      </div>
      -->

      <div class='flex flex-col'>
        <label>Type *</label>
        <div class='flex gap-4 mt-1'>
          <div class='flex items-center gap-2'>
            <input type='checkbox' id='type_attendee' name='type' value='Attendee' class='w-4 h-4' />
            <label for='type_attendee'>Attendee</label>
          </div>
          <div class='flex items-center gap-2'>
            <input type='checkbox' id='type_instructor' name='type' value='Instructor' class='w-4 h-4' />
            <label for='type_instructor'>Instructor</label>
          </div>
          <div class='flex items-center gap-2'>
            <input type='checkbox' id='type_speaker' name='type' value='Speaker' class='w-4 h-4' />
            <label for='type_speaker'>Speaker</label>
          </div>
        </div>
      </div>

      <div class='flex flex-col'>
        <label>Ticket Type *</label>
        <div class='flex gap-4 mt-1'>
          <div class='flex items-center gap-2'>
            <input type='checkbox' id='ticket_premium' name='ticket_type' value='Premium' class='w-4 h-4' />
            <label for='ticket_premium'>Premium</label>
          </div>
          <div class='flex items-center gap-2'>
            <input type='checkbox' id='ticket_expert' name='ticket_type' value='Expert' class='w-4 h-4' />
            <label for='ticket_expert'>Expert</label>
          </div>
          <div class='flex items-center gap-2'>
            <input type='checkbox' id='ticket_pioneer' name='ticket_type' value='Pioneer' class='w-4 h-4' />
            <label for='ticket_pioneer'>Pioneer</label>
          </div>
        </div>
      </div>

      <div class='flex flex-col'>
          <label for='institution'>Institution (Partner)</label>
          <select id='institution' name='institution'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'>
              {{#each partners}}
              <option value='{{this.id}}'>{{this.name}}</option>
              {{/each}}
          </select>
      </div>

      <div class='flex flex-col'>
        <label for='current_location'>Location (City, Country)</label>
        <input type='text' id='current_location' name='current_location'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md' maxlength="40" />
      </div>

      <div class='flex flex-col'>
        <label for='field_of_study_work_research'>Work Field *</label>
        <input type='text' id='field_of_study_work_research' name='field_of_study_work_research'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md' maxlength="40"
          required/>
        <span class="text-xs text-gray-500 mt-1">Maximum 40 characters including spaces</span>
      </div>

      <div class='flex flex-col'>
          <label for='speakerEvents'>Registered Events (as a Speaker/Instructor)</label>
          <select id='speakerEvents' name='speakerEvents'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'>
              {{#each events}}
              <option value='{{this.id}}'>{{this.title}}</option>
              {{/each}}
          </select>
      </div>

      <div class='flex flex-col'>
          <label for='attendeeEvents'>Registered Events (as an Attendee)</label>
          <select id='attendeeEvents' name='attendeeEvents'
          class='px-2 py-1 border border-gray-800 outline-none rounded-md'>
              {{#each events}}
              <option value='{{this.id}}'>{{this.title}}</option>
              {{/each}}
          </select>
      </div>

      <div class='flex flex-col'>
        <label>Expertises *</label>
        <div class='flex flex-wrap gap-2 mt-1'>
          {{#each (array 'Aerospace medicine' 'Artificial intelligence' 'Augmented reality'
          'Biomedical imaging' 'Bionic systems' 'Bioprinting' 'Biosignals'
          'Cell & tissue engineering' 'Chronic diseases' 'Clean technology' 'Clinical decision support systems' 'Clinical research'
          'Data modelling' 'Data science' 'Data-driven healthcare' 'Dentistry' 'Epidemiology' 'Ethics' 'Genetics'
          'Hardware & robotics' 'Healthcare' 'Health data privacy and security' 'Health policy'
          'Machine learning' 'Medical simulation' 'Mental health' 'Neuroscience' 'Nuclear medicine' 'Nutrition'
          'Orthopedics & biomechanics' 'Public health' 'Remote patient monitoring'
          'Scientific writing' 'Statistics for research' 'Surgery' 'Virtual reality' 'Wearable technology') as |expertise|}}
          <label class='relative cursor-pointer'>
            <input type='checkbox' name='expertise' value='{{expertise}}'
              class='peer opacity-0 absolute' />
            <span class='px-4 py-1 rounded-full border border-gray-300 bg-gray-100 text-gray-600 transition peer-checked:bg-green-300 peer-checked:text-gray-900 hover:bg-green-200'>{{expertise}}</span>
          </label>
          {{/each}}
        </div>
        <span class="text-xs text-gray-500 mt-1">Select between 2 and 6 expertises</span>
      </div>

    </div>

    <!-- espaÃ§o de baixo -->
    <div class='flex flex-col gap-2 col-span-2'>
      <label for='biography'>Biography</label>
      <textarea form='create-participant-form' type='text' id='biography' name='biography'
        class='px-2 py-1 border border-gray-800 outline-none rounded-md' rows='4' maxlength="40"></textarea>
      <span class="text-xs text-gray-500 mt-1">Maximum 40 characters including spaces</span>
    </div>

    <div class='w-fit mx-auto col-span-2'>
      <button form='create-participant-form' type='submit'
        class='px-6 py-2 bg-green-600 text-gray-100 rounded-md'
        onclick="return validateParticipantForm()"
      >Save new participant</button>
    </div>
  </form>
</section>

<script src='https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js'></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    ['institution', 'speakerEvents', 'attendeeEvents'].forEach(id => {
      const el = document.getElementById(id);
      if (el) new Choices(el, {
        removeItemButton: true,
        placeholder: true,
        placeholderValue: 'Select or type...',
        duplicateItemsAllowed: false,
        shouldSort: true });
    });
  });

  function validateNameInput(input) {
    const value = input.value;
    // Remove 'de', 'da', 'dos' and count names
    const names = value.split(' ').filter(name =>
      name.length > 0 &&
      !['de', 'da', 'dos'].includes(name.toLowerCase())
    );

    if (names.length > 3) {
      alert('Maximum 3 names allowed (ignoring "de", "da", "dos")');
    }
  }

  function validateParticipantForm() {
    // Ensure at least one Participant TYPE is selected
    const selectedType = document.querySelectorAll('input[name="type"]:checked');
    if (selectedType.length === 0) {
      alert('Please select at least one Type (Attendee, Instructor or Speaker)');
      return false;
    }
    // Ensure one, and only one, Ticket TYPE is selected
    const selectedTicket = document.querySelectorAll('input[name="ticket_type"]:checked');
    if (selectedTicket.length !== 1) {
      alert('Please select one Ticket Type (Pioneer, Expert or Premium)');
      return false;
    }

    const selectedInterests = document.querySelectorAll('input[name="interests"]:checked');
    const selectedExpertises = document.querySelectorAll('input[name="expertise"]:checked');
    if (selectedInterests.length < 2) {
      alert('Please select at least 2 interests');
      return false;
    }
    if (selectedInterests.length > 10) {
      alert('Please select no more than 10 interests');
      return false;
    }
    if (selectedExpertises.length < 2) {
      alert('Please select at least 2 expertises');
      return false;
    }
    if (selectedExpertises.length > 6) {
      alert('Please select no more than 6 expertises');
      return false;
    }
    return true;
  }
</script>